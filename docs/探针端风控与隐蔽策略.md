# 探针端风控与隐蔽策略

哈啰、滴滴等平台会检测**无障碍服务**和**应用列表**，行为过于机器化也会触发风控。以下策略可尽量降低探针号被封风险。

---

## 一、不依赖「无障碍」，优先用 PC + ADB 注入

- **问题**：在系统里打开「无障碍」给 Auto.js / AutoX.js 用，App 启动或发单时很容易检测到，轻则弹窗「请关闭辅助功能」，重则封号。
- **做法**：**不在手机上开无障碍**，改用 **PC 上的 Python + UIAutomator2**，手机用 USB 或网络 ADB 连到电脑，由电脑通过底层 atx-agent 获取界面树并执行点击。对 App 而言，没有「无障碍开关被打开」这一项。
- **本仓库**：抓单用 `uiautomator2_capture.py`，发布/取消行程用 `uiautomator2_publish_trip.py`，均在 **PC 运行**，手机只连 ADB，无需在手机装 AutoX.js 或开无障碍。
- **终极方案**（若连 UIAutomator 都被识别）：Root 下可向 `/dev/input/eventX` 写入触摸事件，模拟物理点击，与真人操作在底层一致（需自行查机型对应 event 设备）。

---

## 二、隐藏自动化/抓包类应用（LSPosed + HideMyApplist）

- **问题**：风控会扫手机已装应用，发现 AutoX.js、抓包工具等会打高风险标签。
- **做法**：Root + Magisk + **LSPosed**，安装 **HideMyApplist**（隐藏应用列表）模块，对哈啰/滴滴 App 配置「隐藏」自动化、抓包等应用。这样从 App 视角看，设备像是只装了顺风车的普通机。
- **注意**：若采用「PC + UIAutomator2」，手机端可不装 AutoX.js，只保留顺风车 App，再配合 HideMyApplist 隐藏其它敏感应用，风险更小。

---

## 三、拟人化操作（避免行为学风控）

- **随机延迟**：人类不可能在界面刷新的毫秒级内就点到按钮。每次点击前加 **随机延迟**，例如 `time.sleep(random.uniform(0.5, 1.5))`，再执行点击。
- **滑动**：下拉刷新或翻页时，不用直线固定坐标滑动，用**贝塞尔曲线**或带加速度的滑动模拟人手。
- **节奏**：不要无间隔地连续发行程、删行程。发完行程后先随机滑动几下、停顿几秒，再执行下一步；取消行程同理，中间加随机等待。

本仓库的 **Python 探针脚本**（`uiautomator2_capture.py`、`uiautomator2_publish_trip.py`）已加入 `human_delay()` 随机等待，循环间隔也带抖动，尽量贴近人类操作节奏。

---

## 四、本仓库脚本与策略对应

| 策略           | 抓单                     | 发布/取消行程                    |
|----------------|--------------------------|----------------------------------|
| 不用无障碍     | 用 PC 跑 `uiautomator2_capture.py` | 用 PC 跑 `uiautomator2_publish_trip.py` |
| 隐藏应用       | 手机不装 AutoX.js，用 HideMyApplist 隐藏其它敏感 App | 同上                             |
| 拟人化         | 循环间隔 + 随机延迟、上报前 human_delay | 每次点击前 human_delay、发布/取消间随机停顿 |

**AutoX.js 脚本**（`autox_capture.js`、`autox_publish_trip.js`）仍保留给**必须用手机本机跑**的场景；若使用，建议：

- 用 **HideMyApplist** 对顺风车 App 隐藏 AutoX.js；
- 在脚本里给每次点击、请求前加 **随机 sleep**（如 0.5～1.5 秒），并适当拉长轮询间隔。

核心建议：**能用 PC + UIAutomator2 就优先用，不占手机性能、不依赖无障碍、更易拟人化。**
