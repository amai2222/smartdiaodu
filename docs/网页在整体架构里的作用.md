# Cloudflare 网页在整体架构里的作用

## 一句话结论

**网页是给「人」用的控制台和看板**：看状态、改参数、发位置。  
**网页不负责调度探针抓取**：探针在 Root 手机上独立 24 小时跑，不依赖网页。

---

## 各端分工（谁做什么）

| 角色 | 所在位置 | 做什么 |
|------|----------|--------|
| **探针** | 家里 Root 安卓机 | 用 AutoX.js / UIAutomator2 **自己循环**抓大厅订单，抓到就 POST 到大脑 API，**不需要网页来触发**。 |
| **大脑** | 你的服务器（VPS） | 接收探针/网页发来的订单或状态，算 PDP、判定是否顺路，决定是否 Bark 推送。 |
| **网页** | Cloudflare Pages | 给你（司机/车队管理员）在浏览器里：看订单、看路线、改司机状态、发位置。 |
| **执行端** | 车上 iPhone | 收 Bark 推送，你手动（或快捷指令）在哈啰大号上抢单。 |

所以：**抓取是探针的事，网页不调度探针**；网页是**显示 + 配置 + 上报位置**的入口。

---

## 网页具体能做什么（按你提的几点）

### 1. 显示我接到的订单？ ✅ 可以

- 大脑可以把「匹配到的订单」存进 Supabase（或通过接口查询）。
- 网页从 Supabase / 大脑 API 拉列表，展示：某司机已接单、起终点、价格、绕路分钟、路线预览等。
- 作用：你在电脑或手机浏览器打开 Cloudflare 上的页面，就能看到当前被系统判定为「顺路」并推过 Bark 的订单。

### 2. 显示地图和线路？ ✅ 可以

- 大脑接口已经返回 `new_route_preview`（途经点地址列表）。
- 网页用地图 SDK（如百度、高德、Leaflet）把 `route_preview` 画成一条线，或标出途经点。
- 作用：一眼看清「接单后的推荐路线」，不用自己心算。

### 3. 发送我的位置给网页接口？ ✅ 可以（且很有用）

- 网页可以调用浏览器定位 API（或你手动输入/选择），拿到「当前司机位置」。
- 定期或点「更新位置」时，把 `driver_loc`（或 lat/lng）POST 到大脑或 Supabase（例如更新 `driver_state.current_loc` / `current_lat` / `current_lng`）。
- 大脑算绕路时用**最新位置**，推送更准。
- 作用：你在车上打开网页、允许定位，系统就知道你在哪，用最新位置做顺路判断。

### 4. 网页来调度/触发探针脚本抓取？ ❌ 一般不这样做

- 探针脚本在**手机本地** 24 小时循环，自己定时抓大厅、自己 POST 到大脑，**不依赖网页是否打开**。
- 若用「网页来调度探针」，要么探针要轮询网页/服务器「要不要开始抓」（多一层且没必要），要么网页发指令到服务器、探针再问服务器（复杂度高）。通常**不推荐**：探针就简单「一直抓、一直报」即可。
- 网页可以做的「调度相关」是：**开启/关闭某司机的接单模式**（例如在网页上点「停止接单」，后端把该司机设为 pause，大脑不再给他推单），这是**业务开关**，不是「触发一次抓取」。

---

## 总结对照表

| 你说的 | 网页能不能做 | 说明 |
|--------|--------------|------|
| 显示我接到的订单 | ✅ 能 | 从 API/Supabase 拉列表，在网页上展示。 |
| 显示地图和线路 | ✅ 能 | 用地图 SDK 画 `route_preview`。 |
| 发送我的位置给接口 | ✅ 能 | 浏览器定位或手动输入，POST 更新司机位置。 |
| 网页来调度探针抓取 | ❌ 一般不这样 | 探针自己跑，不靠网页触发；网页可做「接单开关」等业务控制。 |

所以：**Cloudflare 网页 = 司机/车队的可视控制台和看板**，用来看订单、看路线、更新位置、调参数；**抓取和上报订单由探针独立完成**，不依赖网页。
