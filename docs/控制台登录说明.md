# 控制台登录说明

控制台（index.html）需登录后使用，登录页为 **web/login.html**，用户名密码存于 Supabase 表 **app_users**。

## 默认账号

- **用户名**：`admin`
- **密码**：`123456`  

部署后建议修改密码或仅内网使用。

## 部署步骤

1. **执行数据库迁移**  
   在 Supabase SQL Editor 中执行 **supabase/migrations/003_app_users_login.sql**，会创建 `app_users` 表并插入默认账号（密码为 bcrypt 哈希）。

2. **后端配置**  
   与「网页内推送」共用 Supabase 配置即可：
   - **SUPABASE_URL**：项目 URL
   - **SUPABASE_SERVICE_ROLE_KEY**：服务端密钥（用于查询 `app_users`）  
   可选环境变量 **JWT_SECRET**：用于签发登录 token，不设则使用代码内默认值（建议生产环境改为随机字符串）。

3. **安装依赖**  
   `pip install -r requirements.txt`（含 bcrypt、PyJWT）。

4. **前端**  
   - 打开 **login.html**，填写 API 地址（或留空使用当前域名）、用户名、密码后登录。
   - 登录成功后跳转 **index.html**，token 存于 localStorage；点「退出」清除 token 并回到登录页。
   - 未登录直接访问 index.html 会自动跳转到 login.html。

## 接口

- **POST /login**  
  请求体：`{ "username": "admin", "password": "123456" }`。  
  成功返回：`{ "token": "JWT...", "username": "admin" }`。  
  失败返回 401，detail 为「用户名或密码错误」。

- **GET /auth/me**  
  Header：`Authorization: Bearer <token>`。  
  成功返回：`{ "username": "admin" }`。  
  用于校验 token 是否有效（当前控制台未强制带 token 调接口，可按需在前端请求时附带）。

## 修改密码

在 Supabase SQL Editor 中执行（将 `新密码` 换成你要设的密码）：

```sql
UPDATE app_users
SET password_hash = crypt('新密码', gen_salt('bf'))
WHERE username = 'admin';
```
